var QuickOutput={pageSelected:false,selectExportType:"",selectPageTriggersRangeSelection:true,isFullRecord:function(){return $("#records_chunks").length===0},isMarkedList:function(){var b=$("#output_form");if(!b.length){return false}var c=b.find('input[name="search_mode"]');if(!c.length){return false}var a=c.val();if(typeof a==="undefined"){return false}return a==="MarkedList"},isSafari:Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,removeAddToENWButton:function(){if(QuickOutput.isFullRecord()&&$('[id^="enw_link"]').children().length){$(".quickOutputENW").filter("a").parent("li").remove();var e=$(".saveToMenu").find("a").first();var a=e.text();var b=e.attr("class").split(/\s+/);var c="";$.each(b,function(f,g){if(g.indexOf("quickOutput")===0){c=g}});if(c.length){var d=$(".saveAgainTo").filter(".quickOutputENW").removeClass("quickOutputENW").unbind("click").addClass(c).click(function(f){f.preventDefault();$(".saveToMenu").find("a."+c).click()}).find("span").text(a)}}},selectionsAvailable:function(){if(typeof jQuery!=="undefined"){return $('input[name="marked_list_candidates"]').length>0}}};var captcha={token:null,recaptchaVerified:false,userSIDVerify:null,executeRecaptcha:function(){captcha.token=grecaptcha.getResponse();if(captcha.token==null||captcha.token==""){grecaptcha.reset();grecaptcha.execute()}return captcha.token},validateRecaptcha:function(a){captcha.executeRecaptcha();if(captcha.token){var b=$("#recaptchaUrl").first().text();captcha.userSIDVerify=$("#captcha_token").val();$.ajax({type:"POST",async:false,url:b,data:{response:captcha.token},success:captcha.checkToken,error:function(){captcha.recaptchaVerified=true}})}},checkToken:function(a){var b=a.success;if(b===true){captcha.userSIDVerify=captcha.token;captcha.recaptchaVerified=true}else{captcha.recaptchaVerified=false}},};(function(D){_.templateSettings={interpolate:/\<\@\=(.+?)\@\>/gim,evaluate:/\<\@(.+?)\@\>/gim,escape:/\<\@\-(.+?)\@\>/gim};var F=Backbone.View.extend({el:D(".saveTo"),initialize:function(){_.bindAll(this,"render","showActions");this.render();return this},render:function(){if(this.$el.size()===0){this.$el=D(".saveTo")}this.$el.button({text:false,icons:{primary:"ui-icon-triangle-1-s"}}).click(this.showActions);return this},showActions:function(V){disable_auto_submit();$this=D(V.currentTarget);$button=$this.parent();var T=D(document).height()/2;var U=$button.position().top;var S=U<=T;var W=$button.next().show();W.css({visibility:"visible"}).position({my:S?"left top":"left bottom",at:S?"left bottom":"left top",of:$button.parent().find(".saveAgainTo")});D(document).one("click",function(){W.hide()});return false}});var m=Backbone.View.extend({el:D(".saveAgainTo"),initialize:function(){_.bindAll(this,"render","doPreviousAction");this.render();return this},render:function(){if(this.$el.size()===0){this.$el=D(".saveAgainTo")}this.$el.button().click(this.doPreviousAction);return this},doPreviousAction:function(){return false}});var R=Backbone.Model.extend({});var n=Backbone.View.extend({el:D(".formatForPrintButton"),extraParams:"",format:"formatForPrint",idPrefix:"qoPrint",paramHelper:function(S){return""},shouldRemoveRurl:true,overlayButtonsetClass:"quickoutput-overlay-buttonset",overlayActionClass:"quickoutput-action",overlayCancelActionClass:"quickoutput-cancel-action",notEntitleCloseActionTemplate:_.template(D("#qoNotEntitleCloseActionTemplate").html()),recordSelectedTemplate:_.template(D("#qoRecordSelectedTemplate").html()),recordsSelectedTemplate:_.template(D("#qoRecordsSelectedTemplate").html()),numberOfRecordsTemplate:_.template(D("#qoNumberOfRecordsTemplate").html()),sendingTemplate:_.template(D("#qoSendingTemplate").html()),hiddenValuesTemplate:_.template(D("#qoHiddenValuesTemplate").html()),optionalEmailValidationError:D("#qoOptionalEmailValidationError").html(),requiredEmailValidationError:D("#qoRequiredEmailValidationError").html(),actionButtonsTemplate:function(){var S=this;if(S.idPrefix=="qoCRXLS"){return _.template('<div class="'+S.overlayButtonsetClass+'"><a class="flat-button '+S.overlayCancelActionClass+'" onclick="trackSnowplowEventSE(\'cited-rep-export-excel-send-to-file-cancel\');"  href="#"><@= cancelaction @></a><span class="'+S.overlayActionClass+'" style="pointer-events: none;"><@= action @></span></div>')}else{if(S.idPrefix=="qoCROther"){return _.template('<div class="'+S.overlayButtonsetClass+'"><a class="flat-button '+S.overlayCancelActionClass+'" onclick="trackSnowplowEventSE(\'cited-rep-export-text-send-to-file-cancel\');"  href="#"><@= cancelaction @></a><span class="'+S.overlayActionClass+'" style="pointer-events: none;"><@= action @></span></div>')}else{var T=S.numberOfRecordsSelected();if(T>0||QuickOutput.isFullRecord()||S.idPrefix=="qoFastSave"){return _.template('<div class="'+S.overlayButtonsetClass+'"><a class="flat-button '+S.overlayCancelActionClass+'"href="#"><@= cancelaction @></a><span class="'+S.overlayActionClass+'"><@= action @></span></div>')}else{return _.template('<div class="'+S.overlayButtonsetClass+'"><a class="flat-button '+S.overlayCancelActionClass+'"href="#"><@= cancelaction @></a><span class="'+S.overlayActionClass+'" style="pointer-events: none;"><@= action @></span></div>')}}}},actionSentButtonsTemplate:function(){var S=this;return _.template('<div class="'+S.overlayButtonsetClass+'"><a class="flat-button '+S.overlayCancelActionClass+'"href="#"><@= cancelaction @></a><span class="'+S.overlayActionClass+'"><@= action @></span></div>')},getTemplateContents:function(T,U){var V=this.idPrefix;if(U!==undefined){V=U}var S=D("#"+V+T+"Template");return S.length?S.html():null},templateFactory:function(T,S){var U=this.getTemplateContents(T);if(U!==null){return _.template(U)}if(S){U=this.getTemplateContents(T,"qo");if(U!==null){return _.template(U)}}return _.template("")},buttonTemplate:function(){return this.templateFactory("Button")},titleTemplate:function(){return this.templateFactory("Title")},contentTemplate:function(){return this.templateFactory("Content",true)},detailsTemplate:function(){return this.templateFactory("Details")},actionTemplate:function(){return this.templateFactory("Action",true)},actionRecordSelectedTemplate:function(){return this.templateFactory("ActionRecordselected",true)},sendingTitleTemplate:function(){return this.templateFactory("SendingTitle")},sendingMessageTemplate:function(){return this.templateFactory("SendingMessage",true)},sendingOneMessageTemplate:function(){return this.templateFactory("SendingOneMessage",true)},sentTitleTemplate:function(){return this.templateFactory("SentTitle")},sentMessageTemplate:function(){return this.templateFactory("SentMessage",true)},sentOneMessageTemplate:function(){return this.templateFactory("SentOneMessage",true)},instructionActionTemplate:function(){return this.templateFactory("InstructionAction",true)},hasIncitesEntitleTemplate:function(){return this.templateFactory("HasIncitesEntitle",true)},noIncitesEntitleTemplate:function(){return this.templateFactory("NoIncitesEntitle",true)},datasetMaxTemplate:function(){return this.templateFactory("DatasetMax",true)},cancelActionTemplate:function(){return this.templateFactory("CancelAction",true)},saveActionTemplate:function(){return this.templateFactory("SaveAction",true)},closeActionTemplate:function(){return this.templateFactory("CloseAction",true)},sentCloseActionTemplate:function(){return this.templateFactory("SentCloseAction",true)},errorTemplate:function(){return this.templateFactory("Error",true)},sentTemplate:function(){return this.templateFactory("Sent",true)},initialize:function(S){_.bindAll(this,"isRangeSelected","numberOfRecordsSelected","formInvalid","numberOfRecordsForRange","prepValidator","render","selectionParams","formatNumberWithcommas","baseUrl","downloadFile","handleError","postData","requestUrl","classText","selectCheckBox","allRecordsOnPage","doAction","doCancelAction","doDoneAction","doRefreshAction","fixMode","saveDoAgain","showOptions","showProcessing","showConfirmation","actionButtonsTemplate","actionSentButtonsTemplate","invalidMarkedListOptions","numberOfProcessedRecords","postToNewWindow","rangeFieldsInMaxRecordLimit","removeRurl","saveEmailAddress","selectionsInMarkedListRecordLimit","setFilters","setModel","setRangeParameters","showError","showFormattedError","showJsonError","submitForm","uncheckSelections");if(typeof S!=="undefined"&&typeof S.model!=="undefined"){this.model=S.model}this.render();return this},render:function(){var S=this;S.$el.html(S.buttonTemplate()());S.$el.find('[type="button"],[type="image"]').click(function(T){if(typeof crCharts!=="undefined"&&crCharts!==null){QuickOutput.selectExportType="print";crCharts.publishedItems.renderExportChart();crCharts.timesCited.renderExportChart()}S.showOptions(T)});S.$el.show();S.$el.css({visibility:"visible"});return S},fixMode:function(Z,U){var T=this;var Y=D(U).find('input[name="search_mode"]').val();var X=D(U).find('input[name="colName"]').val();var W=D(Z).find('input[name="mode"]').val();if(W==="quickOutputForCited"&&X==="DIIDW"){if(T.idPrefix!=="qoEmail"){D(U).find('input[name="mode"]').val("OpenQuickOutputForCited")}return}var V=D(U).find('input[name="use_two_ets"]').val();if(T.idPrefix=="qoIncites"&&V=="true"){D(U).find('input[name="mode"]').val("outputServiceForInCites");D(Z).find('input[name="mode"]').val("outputServiceForInCites");return}var aa=D(U).find('input[name="research_id"]').val();var S=D(U).find('input[name="admin_rid"]').val();if(T.shouldSignIn&&typeof aa!=="undefined"&&typeof S!=="undefined"&&(T.idPrefix==="qoRID"||T.idPrefix==="qodistinctAuthorSet")){D(U).find('input[name="mode"]').val("outputServiceForClaimPublications");D(Z).find('input[name="mode"]').val("outputServiceForClaimPublications");return}if(T.fileDownload){D(U).find('input[name="mode"]').val(Y==="CitedRefList"?"CitedRefList-OpenOutputService":W==="quickOutputForUATODII"?"OpenQuickOutputForUATODII":X==="DIIDW"?"OpenQuickOutputForDII":"OpenOutputService");D(Z).find('input[name="mode"]').val(Y==="CitedRefList"?"CitedRefList-OpenOutputService":W==="quickOutputForUATODII"?"OpenQuickOutputForUATODII":X==="DIIDW"?"OpenQuickOutputForDII":"OpenOutputService")}else{if(T.mode){if(T.formName){D(U).find('input[name="mode"]').val((Y==="CitedRefList"?"CitedRefList-":"")+T.mode)}else{D(Z).find('input[name="mode"]').val((Y==="CitedRefList"?"CitedRefList-":"")+T.mode)}}}if(QuickOutput.isMarkedList()&&(T.idPrefix==="qoEmail"||T.idPrefix=="qoENW"||T.idPrefix=="qoRID"||T.idPrefix=="qoPublons"||T.idPrefix=="qoRefWorks"||T.idPrefix=="qoIncites")){if(X==="DIIDW"){D(U).find('input[name="mode"]').val("quickOutputForDII");D(Z).find('input[name="mode"]').val("quickOutputForDII");return}else{D(U).find('input[name="mode"]').val("outputService");D(Z).find('input[name="mode"]').val("outputService");return}}},invalidMarkedListOptions:function(){var W="#output_form";var U=D(W);if(typeof U==="undefined"||U.length<1){return false}var T=U.find('input[name="value(record_select_type)"]:checked');if(typeof T==="undefined"||T.length<1){return false}var S=this;var V=T.val();switch(V){case"range":if(S.idPrefix=="qoIncites"){return false}if(!S.bothRangeFieldsHaveValue(W)){alert(getMessageById("quickOutputNullInARange"));return true}if(!S.bothRangeFieldsAreNumbers(W)){alert(getMessageById("range_specialchar_error"));return true}if(!S.bothRangeFieldsInOrder(W)){alert(getMessageById("range_notsequential_error"));return true}if(!S.bothRangeFieldsInSet(W)){alert(getMessageById("range_notinset_error"));return true}if(!S.rangeFieldsInMaxRecordLimit(W)){if(S.idPrefix=="qoFastSave"){alert(getMessageById("qo_range_morethan_fastsave_error"))}else{alert(getMessageById("qo_range_morethan_maxrec_error"))}return true}break;case"allrecords":if(S.idPrefix=="qoIncites"||S.idPrefix=="qoFastSave"){break}if(CURRENT_NUM_MARKED_LIST_RECORDS>QUICK_OUTPUT_MAX_RECORDS){alert(getMessageById("ml_allrecs_morethan_maxrec_output_notice"));return false}break;case"pagerecordsByValue":case"selrecord":case"selrecords":default:}},removeRurl:function(T,U){var S=this;if(S.shouldRemoveRurl){var V=D(U).find('input[name="rurl"]');S.savedRurl=V.val();V.remove()}},saveEmailAddress:function(T,U){var S=this;D.each([T,U],function(W,V){var X=D(V).find('input[name="emailAddress"]');if(X.length&&X.val().length){D(T).find('input[name="emailAddress"]').val(X.val());D(U).find('input[name="emailAddress"]').val(X.val());S.savedEmailAddress=X.val();return}})},fullRecordParams:function(S){var T=D('form[name="mark_records_form"]').find('[name="selectedIds"]').val();if(typeof T==="undefined"){T="1"}D(S).find('[name="value(record_select_type)"]').val("pagerecords");D(S).find("#mark_from").val(T);D(S).find("#mark_to").val(T);D(S).find("#filters").val(D(S).find('[name="fields_selection"]').val());return"&marked_list_candidates="+T+"&excludeEventConfig=ExcludeIfFromFullRecPage"},setRangeParameters:function(aa,U){var T=this;var ac=D(aa).find('[name="markFrom"]').val();var W=D(aa).find('[name="markTo"]').val();if(typeof ac==="undefined"||!ac.length||typeof W==="undefined"||!W.length){ac=D(U).find('[name="markFrom"]').val();W=D(U).find('[name="markTo"]').val();if(typeof ac==="undefined"||!ac.length||typeof W==="undefined"||!W.length){return}}var X=/^\s*(\d+)\s*$/;var S=ac.match(X);var Y=W.match(X);if(!S||!Y||S.length<2||Y.length<2){return}var V=parseInt(S[1]);var ab=parseInt(Y[1]);if(V>ab){var Z=ab;ab=V;V=Z}D(aa).find("#mark_from").val(V);D(aa).find("#mark_to").val(ab);D(aa).find("#selectedIds").val("");D(aa).find('[name="selectedIds"]').val("");if(T.model){T.model.attributes.selectedIds=""}if(U&&T.idPrefix!="qodistinctAuthorSet"){D(U).find('[name="mark_from"]').val(V);D(U).find('[name="mark_to"]').val(ab);D(U).find("#selectedIds").val("");D(U).find('[name="selectedIds"]').val("")}},isRangeSelected:function(T,V){var S=D(V?V:T).find('[name="value(record_select_type)"]');if(!S.length){if(V){S=D(T).find('[name="value(record_select_type)"]')}if(!S.length){if(this.savedIsRangeSelected){return this.savedIsRangeSelected}return false}}var U=S.filter(":checked");this.savedIsRangeSelected=!(U.length<1||U.val()!=="range");return this.savedIsRangeSelected},selectCheckBox:function(W,V){var T=this;var S=T.markedListCandidates.length;var U=0;if(W){U=W-1}if(!V){V=S}while(U<V){T.markedListCandidates[U].checked=true;U++}return},numberOfRecordsSelected:function(){var T=this;T.markedListCandidates=D("#records_chunks").find('input[name="marked_list_candidates"]');if(QuickOutput.isMarkedList()){var aa=D("#output_form").find('input[name="value(record_select_type)"]:checked').val();if(T.idPrefix=="qoFastSave"){if(CURRENT_NUM_MARKED_LIST_RECORDS>FAST_SAVE_MAX_RECORDS){return FAST_SAVE_MAX_RECORDS}else{return CURRENT_NUM_MARKED_LIST_RECORDS}}if(aa==="allrecords"){if(CURRENT_NUM_MARKED_LIST_RECORDS>QUICK_OUTPUT_MAX_RECORDS){return QUICK_OUTPUT_MAX_RECORDS}return CURRENT_NUM_MARKED_LIST_RECORDS}if(aa==="pagerecords"){return T.markedListCandidates.length}if(aa==="range"){if(T.idPrefix=="qoIncites"){return document.getElementById("incitesCount").value}var U=D("#output_form").find('input[name="markFrom"]').val();var ad=D("#output_form").find('input[name="markTo"]').val();var Y=/^\s*(\d+)\s*$/;var ab=U.match(Y);var ae=ad.match(Y);var aj=parseInt(ab[1]);var W=parseInt(ae[1]);return W-aj+1}}if(T.idPrefix==="qoRIDSignIn"&&T.outputViewType=="distincAuthorSet"){var af=D("#loginForm").find('input[name="mark_from"]').val();var V=D("#loginForm").find('input[name="mark_to"]').val();T.outputToRID=V-af+1;var ai=T.outputToRID;return parseInt(ai)}if(T.idPrefix==="qoRIDSignIn"&&T.outputViewType=="summary"){var ak=D("#loginForm").find('input[name="totalMarked"]').val();T.outputToRID=ak;return parseInt(ak)}if(T.idPrefix=="qoproxyClaim"){T.markedListCandidates=D("#ProxyClaimForm").find('input[name="rid_steamID"]');var S=D("#ProxyClaimForm").find('input[name="mark_from"]').val();var X=D("#ProxyClaimForm").find('input[name="mark_to"]').val();T.outputToProxyRID=X-S+1;var ai=T.outputToProxyRID;return parseInt(ai)}if(T.idPrefix=="qodistinctAuthorSet"){T.markedListCandidates=D("#summary_records_form").find('input[name="selectedId"]');var Z=T.markedListCandidates.filter(":checked");var ac=T.markedListCandidates.filter(":checked").length;var ah=0;var ag=0;while(ag<ac){ah=parseInt(Z[ag].getAttribute("utcount"))+ah;ag++}return ah+_.compact(D.trim(D("#summary_records_form").find('input[name="preSelectedIds"]').val()).split(" ")).length}return T.markedListCandidates.filter(":checked").length},numberOfProcessedRecords:function(){var S=this;if(!S.model){return 0}if(QuickOutput.isMarkedList()){if(S.idPrefix=="qoIncites"){ag=document.getElementById("incitesCount").value;return ag}if(S.idPrefix=="qoFastSave"){return CURRENT_NUM_MARKED_LIST_RECORDS>FAST_SAVE_MAX_RECORDS?FAST_SAVE_MAX_RECORDS:CURRENT_NUM_MARKED_LIST_RECORDS}var Z=S.model.get("value(record_select_type)");switch(Z){case"range":var T=S.model.get("markFrom");var ab=S.model.get("markTo");var Y=/^\s*(\d+)\s*$/;var aa=T.match(Y);var ac=ab.match(Y);var aj=parseInt(aa[1]);var V=parseInt(ac[1]);return V-aj+1;break;case"pagerecords":return S.markedListCandidates.length;break;case"allrecords":default:if(CURRENT_NUM_MARKED_LIST_RECORDS>QUICK_OUTPUT_MAX_RECORDS){return QUICK_OUTPUT_MAX_RECORDS}return CURRENT_NUM_MARKED_LIST_RECORDS}}if((S.idPrefix==="qoRIDSignIn"&&(S.outputViewType=="distincAuthorSet"||S.outputViewType=="summary"))||S.idPrefix=="qoproxyClaim"){var ae=S.model.get("mark_from");var U=S.model.get("mark_to");if(S.idPrefix=="qoproxyClaim"){ae=D("#ProxyClaimForm").find('input[name="mark_from"]').val();U=D("#ProxyClaimForm").find('input[name="mark_to"]').val()}var ai=null;if(U&&ae){ai=U-ae+1}else{ai=S.model.get("totalMarked")}return ai>QUICK_OUTPUT_MAX_RECORDS?QUICK_OUTPUT_MAX_RECORDS:ai}if(S.idPrefix==="qoRIDSignIn"&&S.outputViewType=="summary"){var ak=S.model.get("totalMarked");if(!ak){var ae=S.model.get("mark_from");var U=S.model.get("mark_to");if(U&&ae){ak=U-ae+1}}return ak>QUICK_OUTPUT_MAX_RECORDS?QUICK_OUTPUT_MAX_RECORDS:ak}if(S.idPrefix=="qodistinctAuthorSet"){S.markedListCandidates=D("#summary_records_form").find('input[name="selectedId"]');var X=S.markedListCandidates.filter(":checked");var ad=X.map(function(){return this.value}).get();var ah=D("#summary_records_form").find('input[name="preSelectedIds"]');if(ah.length&&ah.val()){var W=_.filter(_.compact(D.trim(ah.val()).split(" ")),function(al){return(D.inArray(al,ad)===-1)});if(W.length||ad.length){return W.length+ad.length}}var ag=0;var af=0;while(af<X.length){ag=parseInt(X[af].getAttribute("utcount"))+ag;af++}return ag>QUICK_OUTPUT_MAX_RECORDS?QUICK_OUTPUT_MAX_RECORDS:ag}if(S.idPrefix=="qoIncites"){ag=document.getElementById("incitesCount").value;return ag}return D("#records_chunks").find('input[name="marked_list_candidates"]:checked').length},numberOfRecordsForRange:function(Z){var V=D(Z).find('[name="markFrom"]');var S=D(Z).find('[name="markTo"]');if(!V.length){if(this.savedNumberOfRecordsForRange){return this.savedNumberOfRecordsForRange}return}var ab=V.val();var W=S.val();var X=/^\s*(\d+)\s*$/;var T=ab.match(X);var Y=W.match(X);var U=parseInt(T[1]);var aa=parseInt(Y[1]);this.savedNumberOfRecordsForRange=aa-U+1;return this.savedNumberOfRecordsForRange},allRecordsOnPage:function(T,V){var S=this;var U=S.markedListCandidates.map(function(){return this.value}).get().join(";");D(V).find("#selectedIds").val(U);D(V).find("#mark_from").val(S.markedListCandidates.first().val());D(V).find("#mark_to").val(S.markedListCandidates.last().val());D(T).find("#mark_from").val(S.markedListCandidates.first().val());D(T).find("#mark_to").val(S.markedListCandidates.last().val());return"&totalMarked="+S.markedListCandidates.length},baseUrl:function(T,W){var S=this;var V=S.getTemplateContents("BaseUrl");if(V!==null){return"/"+D.trim(V)}var U=D(W).find('input[name="research_id"]').val();if(typeof U==="undefined"){U=D(T).find('input[name="research_id"]').val()}var X=D(W).find('input[name="admin_rid"]').val();if(typeof U==="undefined"){X=D(T).find('input[name="admin_rid"]').val()}if(S.idPrefix==="mlAdd"||S.buttonClassPrefix==="ui-dialog-add"){return"/MarkRecords.do?"}else{if(S.shouldSignIn&&typeof U==="undefined"&&typeof X==="undefined"&&(S.idPrefix==="qoRID"||S.idPrefix==="qodistinctAuthorSet")){S.quickOutputSendMessageTemplate=false;S.refreshWindow=true;S.shouldShowProcessing=false;return"/DACSLogin.do?"}else{if(S.shouldSignIn&&typeof U!=="undefined"&&typeof X!=="undefined"&&(S.idPrefix==="qoRID"||S.idPrefix==="qodistinctAuthorSet")){S.quickOutputSendMessageTemplate=false;S.refreshWindow=true;return"/ProxyClaim.do?"}else{if(S.idPrefix==="qoRIDSignIn"){return"/DACSLoginValidation.do?action=go"}else{if(S.idPrefix==="qoproxyClaim"){return"/ProxyClaimSubmit.do?"}}}}}return"/OutboundService.do?action="+(S.action?S.action:"go")},requestUrl:function(T,V){var S=this;var U=S.baseUrl(T,V);return window.location.protocol+"//"+window.location.host+D("#contextPath").html()+U},postData:function(T,V,U){var S=this;return(S.useParamHelperOnly?"":S.useBothForm||QuickOutput.isMarkedList()?D(V).serialize()+"&"+D(T).find("form").serialize():S.formName?D(V).serialize():D(T).find("form").serialize())+"&"+S.extraParams+"&"+U},downloadFile:function(U,W,V){var S=this;var T=D("#saveDiv");if(!T.length){T=D(document.createElement("div")).attr("id","saveDiv").css("display","none");D("body").append(T)}S.checkExportChart=function(){if((QuickOutput.selectExportType==="xls")&&!(D("#rawTCChartImageData").val()&&D("#rawPIChartImageData").val())){return setTimeout(S.checkExportChart,100)}else{S.setModel(U,W);T.html("").append(S.deserialize(S.model.attributes,S.requestUrl(U,W)+"&"+S.extraParams+"&"+V)).find("form").submit()}};S.checkExportChart()},handleError:function(W,V,U){var S=this;if(typeof S.newDiv==="undefined"){return}var T=S.newDiv;if(W.status===404){D(T).html("Cannot connect. Please try again.")}else{if(V==="timeout"&&S.idPrefix=="qoIncites"){D(T).html("Sorry, your dataset was not saved. Please try again in a few minutes.")}else{D(T).dialog("option",{hide:{effect:"fade",duration:1500}});D(T).dialog("close")}}},setReturnUrl:function(T,V){var S=this;var U=D(T).find('input[name="rurl"]').val();S.returnUrl=U;return false},selectionParams:function(aa){var S=this;if(QuickOutput.isMarkedList()){var X=D("#output_form").find('input[name="value(record_select_type)"]:checked').val();if(X==="allrecords"){var Y=CURRENT_NUM_MARKED_LIST_RECORDS<=QUICK_OUTPUT_MAX_RECORDS?CURRENT_NUM_MARKED_LIST_RECORDS:QUICK_OUTPUT_MAX_RECORDS;D(aa).find("#selectedIds").val("");D(aa).find("#selectedIds").val("");return"&totalMarked="+Y}}var Z=S.markedListCandidates.filter(":checked");if(D("#numberOfRecordsSelected").is(":checked")){Z=S.markedListCandidates.filter(":checked")}else{if(D("#numberOfRecordsAllOnPage").is(":checked")){Z=S.markedListCandidates}}var T=Z.map(function(){return this.value}).get();var V=D("#summary_records_form").find('input[name="preSelectedIds"]');var U=V.length&&V.val()?_.filter(_.compact(D.trim(V.val()).split(" ")),function(ab){return(D.inArray(ab,T)===-1)}):[];if(S.idPrefix!="qoIncites"){var W=U.join(";")+(T.length&&U.length?";":"")+T.join(";");D(aa).find("#selectedIds").val(W)}return"&totalMarked="+Z.length},setFilters:function(S,T){if(QuickOutput.isMarkedList()){D(T).find("#filters").val(D(T).find('input[name="fields"]:checked').map(function(){return this.value}).get().join(" "));D(S).find("#filters").val(D(T).find('input[name="fields"]:checked').map(function(){return this.value}).get().join(" "))}else{D(S).find("#filters").val(D(S).find('[name="fields_selection"]').val())}},uncheckSelections:function(){var S=this;if(typeof S.markedListCandidates==="undefined"||S.markedListCandidates.length===0){S.markedListCandidates=D("#records_chunks").find('input[name="marked_list_candidates"]')}S.uncheckItems(S.markedListCandidates);var T=D(".SelectPageChk");S.uncheckItems(T);QuickOutput.pageSelected=false},uncheckItems:function(S){if(S!=null){S.filter(":checked").removeAttr("checked")}},saveDoAgain:function(S){if(!this.saveAction){return}if(this.noSaveActionOnFullRecord&&QuickOutput.isFullRecord()){return}D(".saveAgainTo").unbind("click").click(this.showOptions).children().html(D(this.saveAction).filter("a").html())},formatNumberWithcommas:function(S){var T=S.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",");return T},formInvalid:function(S){var T=D(S).find("form");if(!T.length){return false}return !T.valid()},dataSetEmpty:function(){var S=document.getElementById("dataSet").value;if(S==null||S==""){return true}return false},deserialize:function(X,T){var U=D(document.createElement("form"));T=T.replace(/\r?\n/g,"");D(U).attr("action",D(document.createElement("div")).html(T).text()).attr("method","POST");var W=function(Z,aa){var Y=D(document.createElement("input"));if(Z==="queryNatural"){aa=aa.replace(new RegExp("#","g"),"")}D(Y).attr("type","hidden").attr("name",Z).attr("value",aa).appendTo(U)};for(var V in X){if(X[V].push){for(var S=0;S<X[V].length;S++){W(V,X[V][S])}}else{W(V,X[V])}}return U},serialize:function(T){var U=[];for(var S in T){U.push(encodeURIComponent(S)+"="+encodeURIComponent(T[S]))}return U.join("&")},setModel:function(aa,V){var T=this;if(typeof T.model==="undefined"){return}var U={};var ab={};if(T.fieldsWanted){D.each(T.fieldsWanted,function(){ab[this]=true})}var S=function(ad){if(ad.value.length){if(U[ad.name]===undefined){U[ad.name]=ad.value||""}else{if(!U[ad.name].push){if(U[ad.name]===ad.value){return}U[ad.name]=[U[ad.name]]}U[ad.name].push(ad.value||"")}}};var X=typeof V!=="undefined"&&aa!==V?[aa,V]:[aa];var Y={};for(var ac in X){var W=X[ac];var Z=D(W).serializeArray();if(typeof Z==="undefined"||Z.length<1){Z=D(W).find("form").serializeArray()}if(T.fieldsWanted){D.each(Z,function(){if(ac==0&&typeof this.value!=="undefined"&&this.value.length){Y[this.name]=true}if(ac==0||!Y[this.name]){if(ab[this.name]){S(this)}}})}else{if(ac==0&&typeof this.value!=="undefined"&&this.value.length){Y[this.name]=true}if(ac==0||!Y[this.name]){D.each(Z,function(){S(this)})}}}T.model.set(U)},doAction:function(Y){Y.preventDefault();var T=this;if(typeof T.newDiv==="undefined"){return}if(T.idPrefix=="qoPrint"){exportFunctionality(T)}var ac=T.newDiv;if(T.formInvalid(ac)){return}if(T.shouldCertifyPublicationsForRID){var ae=certifyPublicationsForRID();if(!ae){saveOutputForm("UA_output_input_form");D(".saveToMenu").filter("select").select2("close");D(ac).dialog("close");return}}if(T.idPrefix=="qoIncites"){if(T.dataSetEmpty()){document.getElementById("dataSetEmpty").style.display="";return}else{document.getElementById("dataSetEmpty").style.display="None"}}var aj=QuickOutput.isMarkedList()?"#output_form":T.formName?'form[name="'+T.formName+'"]':ac;T.fixMode(ac,aj);T.saveEmailAddress(ac,aj);T.removeRurl(ac,aj);if(T.formName&&T.noSaveAction!==true){D(aj).find('input[name="action"]').val("go")}var S="";T.setReturnUrl(ac,aj);D(aj).find("#format").val(T.format);D(ac).find("#format").val(T.format);if(QuickOutput.isFullRecord()){S+=T.fullRecordParams(ac)}else{if((T.numberOfRecordsSelected()&&!T.isRangeSelected(ac,aj))&&T.idPrefix!="qoIncites"){S+=T.selectionParams(aj);if(T.idPrefix=="qodistinctAuthorSet"){S+="&mark_from=1&mark_to="+T.numberOfRecordsSelected()}if(QuickOutput.isMarkedList()){var af=D("#output_form").find('input[name="value(record_select_type)"]:checked').val();var ab=0;if(T.idPrefix=="qoFastSave"){ab=CURRENT_NUM_MARKED_LIST_RECORDS>FAST_SAVE_MAX_RECORDS?FAST_SAVE_MAX_RECORDS:CURRENT_NUM_MARKED_LIST_RECORDS;D(ac).find('[name="mark_from"]').val(1);D(ac).find('[name="mark_to"]').val(ab);D(aj).find('[name="mark_from"]').val(1);D(aj).find('[name="mark_to"]').val(ab);D(ac).find('[name="totalMarked"]').val(ab);D(aj).find('[name="totalMarked"]').val(ab)}else{if(af==="allrecords"){ab=CURRENT_NUM_MARKED_LIST_RECORDS>QUICK_OUTPUT_MAX_RECORDS?QUICK_OUTPUT_MAX_RECORDS:T.numberOfRecordsSelected();D(ac).find('[name="mark_from"]').val(1);D(ac).find('[name="mark_to"]').val(ab);D(aj).find('[name="mark_from"]').val(1);D(aj).find('[name="mark_to"]').val(ab);D(ac).find('[name="totalMarked"]').val(ab);D(aj).find('[name="totalMarked"]').val(ab)}if(af==="pagerecords"){var ao=T.markedListCandidates.length;var X=T.markedListCandidates[0].value;var ab=parseInt(X)+parseInt(ao)-1;D(ac).find('[name="mark_from"]').val(X);D(ac).find('[name="mark_to"]').val(ab);D(aj).find('[name="mark_from"]').val(X);D(aj).find('[name="mark_to"]').val(ab);D(ac).find('[name="totalMarked"]').val(ao);D(aj).find('[name="totalMarked"]').val(ao)}if(af==="range"){var U=D("#output_form").find('input[name="markFrom"]').val();var ah=D("#output_form").find('input[name="markTo"]').val();var ad=/^\s*(\d+)\s*$/;var ag=U.match(ad);var ai=ah.match(ad);var an=parseInt(ag[1]);var Z=parseInt(ai[1]);var ao=Z-an+1;D(ac).find('[name="mark_from"]').val(an);D(ac).find('[name="mark_to"]').val(Z);D(aj).find('[name="mark_from"]').val(an);D(aj).find('[name="mark_to"]').val(Z);D(ac).find('[name="totalMarked"]').val(ao);D(aj).find('[name="totalMarked"]').val(ao)}}}}else{if(T.isRangeSelected(ac,aj)){T.setRangeParameters(ac,aj);if(T.idPrefix=="qodistinctAuthorSet"){var ap=D(ac).find('[name="markFrom"]').val();var al=D(ac).find('[name="markTo"]').val();T.selectCheckBox(ap,al);var V=T.numberOfRecordsSelected();S+=T.selectionParams(aj);S+="&mark_from=1&mark_to="+V;D(ac).find('input[name="daTotalRecords"]').val(V);if(T.formInvalid(ac)){return}}if(T.idPrefix=="qoIncites"){var am=document.getElementById("incitesCount").value;D(ac).find('[name="mark_from"]').val(1);D(ac).find('[name="mark_to"]').val(am);D(aj).find('[name="mark_from"]').val(1);D(aj).find('[name="mark_to"]').val(am);D(ac).find('[name="totalMarked"]').val(1);D(aj).find('[name="totalMarked"]').val(am);D(ac).find("#selectedIds").val("")}}else{if(T.idPrefix=="qodistinctAuthorSet"){T.selectCheckBox();S+=T.selectionParams(aj);var V=T.numberOfRecordsSelected();S+="&mark_from=1&mark_to="+V;D(ac).find('input[name="daTotalRecords"]').val(V);if(T.formInvalid(ac)){return}}if(T.idPrefix=="qoIncites"){var am=document.getElementById("incitesCount").value;D(ac).find('[name="mark_from"]').val(1);D(ac).find('[name="mark_to"]').val(am);D(aj).find('[name="mark_from"]').val(1);D(aj).find('[name="mark_to"]').val(am);D(ac).find('[name="totalMarked"]').val(1);D(aj).find('[name="totalMarked"]').val(am);D(ac).find("#selectedIds").val("")}else{S+=T.allRecordsOnPage(ac,aj)}}}T.setFilters(ac,aj);var aa=T.paramHelper(ac);if(aa.length){S=(T.useParamHelperOnly?"":S)+"&"+aa}}T.setModel(ac,aj);var ak=T.requestUrl(ac,aj);var W=T.postData(ac,aj,S);T.savedRequestUrl=ak;T.savedPostData=W;if(T.idPrefix=="qoFastSave"&&T.fileDownload||T.useIFrame){if(!captcha.userSIDVerify){captcha.userSIDVerify=D("#captcha_token").val()}if(D("#google_recaptcha_wall").val().toLowerCase()!=="off"&&T.shouldExecuteRecaptcha&&captcha.userSIDVerify==null){captcha.validateRecaptcha();if(captcha.recaptchaVerified){T.downloadFile(ac,aj,S);T.showProcessing(Y);T.showConfirmation("",Y)}else{return}}else{T.downloadFile(ac,aj,S);T.showProcessing(Y);T.showConfirmation("",Y)}}else{if(T.fileDownload||T.useIFrame){T.downloadFile(ac,aj,S);T.showProcessing(Y);T.showConfirmation("",Y)}else{if(T.newWindow&&!T.shouldPostToNewWindow){T.showProcessing(Y);window.open(ak+"&"+W,"_blank");D(ac).dialog("close");T.uncheckSelections()}else{if(QuickOutput.selectExportType==="print"){T.checkExportChart=function(){if((QuickOutput.selectExportType==="print")&&!(D("#rawTCChartImageData").val()&&D("#rawPIChartImageData").val())){return setTimeout(T.checkExportChart,100)}else{W=T.postData(ac,aj,S);T.showProcessing(Y);D.ajax({type:"POST",url:ak,data:W,timeout:120000,success:T.showConfirmation,error:T.handleError})}};T.checkExportChart()}else{if(T.refreshWindow){T.showProcessing(Y);T.uncheckSelections();D(location).attr("href",ak+"&"+W)}else{T.showProcessing(Y);D.ajax({type:"POST",url:ak,data:W,timeout:120000,success:T.showConfirmation,error:T.handleError})}}}}}},doDoneAction:function(T){var S=this;if(typeof S.newDiv!=="undefined"){D(S.newDiv).dialog("close")}},doRefreshAction:function(T){var S=location.href;if(S.indexOf("ExcludeIfFromNonInterProduct")>-1){S=S.replace("ExcludeIfFromNonInterProduct","ExcludeIfReload")}if(S.indexOf("ExcludeIfFromFullRecPage")>-1){S=S.replace("ExcludeIfFromFullRecPage","ExcludeIfReload")}if(S.indexOf("excludeEventConfig")==-1){S=S+"&excludeEventConfig=ExcludeIfReload"}if(S.indexOf("exclude=")>1&&S.indexOf("InboundService.do")>1){window.location.reload()}else{window.location.replace(S)}},doCancelAction:function(T){enableAutoSubmit();T.preventDefault();var S=this;if(typeof S.newDiv!=="undefined"){D(S.newDiv).dialog("option",{hide:{effect:"fade",duration:300}});D(S.newDiv).dialog("close")}},bothRangeFieldsHaveValue:function(S){var T=true;D.each(["markFrom","markTo"],function(W,U){var X=D(S).find('input[name="'+U+'"]').val();var V=X.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(!V.length){T=false}});return T},bothRangeFieldsAreNumbers:function(S){var T=true;D.each(["markFrom","markTo"],function(W,U){var X=D(S).find('input[name="'+U+'"]').val();var V=X.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if(!isPosInteger(V)){T=false}});return T},bothRangeFieldsInOrder:function(U){var S=D(U).find('input[name="markFrom"]').val();var T=D(U).find('input[name="markTo"]').val();return(T-S)>=0},bothRangeFieldsInSet:function(X){var W=null;var S=document.getElementById("trueFinalResultCount");if(S==null){S=document.getElementById("hitCount.top")}if(S!=null){W=S.innerHTML.toString();if(null==W||""===W){W=S.value}}if(W!=null&&W.indexOf(",")>-1){var V=/,/g;W=parseInt(W.replace(V,""))}if(W==null){W=CURRENT_NUM_MARKED_LIST_RECORDS}if(W==null){return true}var T=parseInt(D(X).find('input[name="markFrom"]').val());var U=parseInt(D(X).find('input[name="markTo"]').val());if(T!=0&&T<=W&&U!=0&&U<=W){return true}else{return false}},rangeFieldsInMaxRecordLimit:function(V){var S=this;if(S.idPrefix=="qoIncites"){return false}var W=0;if(S.idPrefix=="qoFastSave"){W=FAST_SAVE_MAX_RECORDS}else{W=(S.idPrefix==="mlAdd")?MARKED_LIST_MAX_RECORDS:QUICK_OUTPUT_MAX_RECORDS}var T=D(V).find('input[name="markFrom"]').val();var U=D(V).find('input[name="markTo"]').val();return(U-T+1)<=W},selectionsInMarkedListRecordLimit:function(U){var S=this;if(S.idPrefix!=="mlAdd"){return true}var X=MARKED_LIST_MAX_RECORDS;var W=D("#MLCount");if(!W.length){return true}var T=parseInt(W.first().text().replace(new RegExp("[^0-9]","g"),""));var V=T+U;return V<=X},prepValidator:function(T){var S=this;var U=D(T).find("form");if(!U.length){return}D.validator.addMethod("bothRangeFieldsHaveValue",function(W,V){if(this.optional(V)===true||!S.isRangeSelected(T)){return true}return S.bothRangeFieldsHaveValue(T)},getMessageById("quickOutputNullInARange"));D.validator.addMethod("bothRangeFieldsAreNumbers",function(W,V){if(this.optional(V)===true||!S.isRangeSelected(T)){return true}return S.bothRangeFieldsAreNumbers(T)},getMessageById("range_specialchar_error"));D.validator.addMethod("bothRangeFieldsInOrder",function(W,V){if(this.optional(V)===true||!S.isRangeSelected(T)){return true}return S.bothRangeFieldsInOrder(T)},getMessageById("range_notsequential_error"));D.validator.addMethod("bothRangeFieldsInSet",function(W,V){if(this.optional(V)===true||!S.isRangeSelected(T)){return true}return S.bothRangeFieldsInSet(T)},getMessageById("range_notinset_error"));D.validator.addMethod("rangeFieldsInMaxRecordLimit",function(W,V){if(this.optional(V)===true||!S.isRangeSelected(T)){if(S.idPrefix!=="qodistinctAuthorSet"){return true}}return S.rangeFieldsInMaxRecordLimit(T)},getMessageById((S.idPrefix=="qoFastSave")?"qo_range_morethan_fastsave_error":(S.idPrefix==="mlAdd")?"ml_range_morethan_maxrec_error":"qo_range_morethan_maxrec_error"));D.validator.addMethod("totalInMarkedListRecordLimit",function(ac,Z){var X=T;if(S.idPrefix!=="mlAdd"){return true}var Y=MARKED_LIST_MAX_RECORDS;var V=D("#MLCount");if(!V.length){return true}if(this.optional(Z)===true||!S.isRangeSelected(T)){return true}var W=parseInt(V.first().text().replace(new RegExp("[^0-9]","g"),""));var ad=D(X).find('input[name="markFrom"]').val();var aa=D(X).find('input[name="markTo"]').val();var ab=W+(aa-ad+1);return ab<=Y},getMessageById("ml_total_morethan_maxrec_error"));D.validator.addMethod("totalWithPageInMarkedListRecordLimit",function(Y,W){var X=T;if(S.idPrefix!=="mlAdd"||S.isRangeSelected(X)){return true}var ab=MARKED_LIST_MAX_RECORDS;var aa=D("#MLCount");if(!aa.length){return true}var V=parseInt(aa.first().text().replace(new RegExp("[^0-9]","g"),""));var Z=V+S.markedListCandidates.length;return Z<=ab},getMessageById("ml_total_morethan_maxrec_error"));D.validator.addMethod("darangeFieldsLessThanHighestRecord",function(W,V){var X=D(T).find('input[name="daTotalRecords"]').val();return(parseInt(X)<=parseInt(QUICK_OUTPUT_MAX_RECORDS))},getMessageById("qo_range_morethan_maxrec_error"));D.validator.addMethod("rangeFieldsLessThanHighestRecord",function(X,W){if(this.optional(W)===true||!S.isRangeSelected(T)){return true}var V=D(T).find('input[name="markTo"]').val();return(parseInt(V)<=parseInt(QUICK_OUTPUT_HIGHEST_RECORDS))},getMessageById("qo_range_morethan_highestrec_error"));D.validator.addMethod("multiemail",function(X,W){if(this.optional(W)){return true}var Y=X.split(/[;,]+/);valid=true;for(var V in Y){X=Y[V];valid=valid&&jQuery.validator.methods.email.call(this,D.trim(X),W)}return valid},jQuery.validator.messages.email);U.validate({onfocusout:false,ignore:[],errorPlacement:function(Y,Z){var X=Z.attr("name");if(X==="value(record_select_type)"){var aa=D(Z).parent().siblings();aa.filter("label.error-range").remove();var ab=aa.filter("label.error");if(!ab.length){Y.addClass("error-pagerecords").insertAfter(aa.last()[0])}}else{if(X==="markFrom"||X==="markTo"){var ac=D(Z).parents(".number-of-records-range");ac.addClass("error");ac.siblings("label.error-pagerecords").remove();var ab=ac.siblings("label.error");if(!ab.length){Y.addClass("error-range").insertAfter(ac)}}else{if(X==="emailAddress"||X==="returnEmail"||X==="notes"){Z.parent().prepend(Y);Z.parent().addClass("error")}else{if(X==="daTotalRecords"){var W=D(document.createElement("div"));W.addClass("da-error");W.insertAfter(Z);Y.appendTo(W)}else{var V=D(document.createElement("span"));V.addClass("xmark");V.insertAfter(Z);Y.insertAfter(V)}}}}},rules:{emailAddress:"required multiemail",markFrom:"bothRangeFieldsHaveValue bothRangeFieldsAreNumbers bothRangeFieldsInOrder bothRangeFieldsInSet rangeFieldsInMaxRecordLimit rangeFieldsLessThanHighestRecord totalInMarkedListRecordLimit",markTo:"bothRangeFieldsHaveValue bothRangeFieldsAreNumbers bothRangeFieldsInOrder bothRangeFieldsInSet rangeFieldsInMaxRecordLimit rangeFieldsLessThanHighestRecord totalInMarkedListRecordLimit",returnEmail:"multiemail",daTotalRecords:"darangeFieldsLessThanHighestRecord","value(record_select_type)":"totalWithPageInMarkedListRecordLimit"},messages:{emailAddress:S.requiredEmailValidationError,returnEmail:S.optionalEmailValidationError},unhighlight:function(Y,V,W){var X=D(Y).attr("name");if(X==="value(record_select_type)"){var Z=D(Y).parent().siblings();var aa=Z.filter("label.error-pagerecords");if(aa.length){aa.remove()}}else{if(X==="markFrom"||X==="markTo"){D.each(["markFrom","markTo"],function(ad,ac){D(T).find('input[name="'+ac+'"]').removeClass(V)});var ab=D(Y).parents(".number-of-records-range");ab.removeClass("error");var aa=ab.siblings("label.error-range");if(aa.length){aa.remove()}}else{if(X==="emailAddress"||X==="returnEmail"||X==="notes"){D(Y).parent().removeClass("error")}else{D(Y).removeClass(V);var Z=D(Y).siblings();Z.filter("span.xmark").remove();Z.filter("label."+V).first().remove()}}}}})},showOptions:function(aa){disable_auto_submit();var W=D(aa.currentTarget).filter("#ui-active-menuitem");if(W){D(W).parent().parent().hide()}var T=D(".saveToMenu").filter("select");aa.preventDefault();var S=this;if(S.idPrefix=="qoRIDSignIn"){var ad=isLoginReadyNoSubmit(loginForm);if(!ad){return}}if(S.idPrefix==="qoFastSave"&&D("#fast5K_signedin").val()=="false"&&D("#HS_EndNoteLink_signedin").length===0&&D("#fast5k_login_wall").val().toLowerCase()!=="off"){return csiovl("qoFastSave","",false)}S.saveDoAgain(aa);if(S.shouldSignIn&&D("#"+S.csiId).length===1&&(S.idPrefix!=="qoRID"&&S.idPrefix!=="qodistinctAuthorSet")){var aq=D("#enURL").val();if(S.idPrefix==="qoENW"&&D("#enw_signedin").val()=="false"){return csiovl("SAVEENW",aq,false)}if(S.idPrefix==="qoIncites"){if(D("#incites_signedin").val()=="false"){return csiovl("INCITES",aq,false)}}}if(D("#force_refreshpage").val()=="true"){S.shouldRefreshAfter=true;D("#force_refreshpage").val("false")}if(typeof S.newDiv==="undefined"){S.newDiv=D(document.createElement("div"))}if(QuickOutput.isMarkedList()&&S.invalidMarkedListOptions()){return}if(QuickOutput.isMarkedList()&&S.noOptionsOnMarkedList){return S.doAction(aa)}var ac=S.newDiv;S.outputViewType=D("#loginForm").find('input[name="viewType"]').val();S.outputProxyViewType=D("#ProxyClaimForm").find('input[name="viewType"]').val();var V=S.numberOfRecordsSelected();if(S.idPrefix=="qodistinctAuthorSet"&&S.noOptionsForSelections){if(V<1){var af=document.getElementById("selectAtLeastOneDAISYSet");alert(af.value);return}if(V>QUICK_OUTPUT_MAX_RECORDS){document.getElementById("searchErrorMessage").style.display="";return}}if(S.idPrefix=="qoproxyClaim"){var al=proxyAddToPubList_submit();if(al==false){return}}if(S.idPrefix=="mlAdd"&&V>0){if(S.selectionsInMarkedListRecordLimit(V)){var ao=getRecordsForm();return mark_selected_records(ao)}alert(getMessageById("ml_total_morethan_maxrec_error"));return}var am=null;var ah=null;if(S.idPrefix==="qoIncites"){am=document.getElementById("IncitesEntitled").value;if(am=="yes"){var av=document.createElement("a");av.setAttribute("href",window.location.href);var ak=av.pathname;var Y="";var ap=ak.split("/");for(i=0;i<ap.length;i++){Y+="/";if(i<(ap.length-1)){Y+=ap[i]}}getCustomDataSetInfo(av.protocol+"//"+av.hostname+(av.port?":"+av.port:"")+(Y?Y:"")+"/AsyncIC2DataSetNum.do?SID="+D("#SID").val()+"&product=WOS")}V=document.getElementById("incitesCount").value;ah=document.getElementById("IsAtMaxLimit").value;if(am=="no"||V==0||ah=="1"){S.noDetails="true"}else{S.noDetails=undefined}}if(S.idPrefix=="qoFastSave"&&!QuickOutput.isMarkedList()){V=0;S.uncheckSelections()}var X=(QuickOutput.isFullRecord()||ah=="1")?"":V>0&&!(QuickOutput.selectPageTriggersRangeSelection&&QuickOutput.pageSelected)?V>1?S.recordsSelectedTemplate({selectedCount:V}):S.recordSelectedTemplate():S.numberOfRecordsTemplate();var ai=(S.idPrefix=="qoIncites"&&am=="yes"&&ah=="0")?S.hasIncitesEntitleTemplate()():S.idPrefix=="qoIncites"&&ah=="1"?S.datasetMaxTemplate()():V;var an=(S.idPrefix=="qoIncites"&&(V==0||ah=="1"))?S.closeActionTemplate()():(S.idPrefix=="qoIncites"&&(am=="yes"&&ah=="0"))?S.saveActionTemplate()():(S.idPrefix=="qoIncites"&&(am=="no"))?S.notEntitleCloseActionTemplate():(V>0||QuickOutput.isFullRecord())?S.actionButtonsTemplate()({action:S.actionRecordSelectedTemplate()(),cancelaction:S.cancelActionTemplate()()}):S.actionButtonsTemplate()({action:S.actionTemplate()(),cancelaction:S.cancelActionTemplate()()});if(S.idPrefix=="qoIncites"&&am=="no"){D(ac).html(S.noIncitesEntitleTemplate()({buttons:(an)}))}else{D(ac).html(S.contentTemplate()({outputHiddenValues:S.hiddenValuesTemplate(),numberOfRecords:X,daTotalRecords:(ai),details:(S.noDetails?"":S.detailsTemplate()()),buttons:(an)}))}if(S.idPrefix=="qoIncites"&&(V==0||ah=="1")){if(S.shouldRefreshAfter){D(ac).find("."+S.overlayCancelActionClass).click(S.doRefreshAction)}else{D(ac).find("."+S.overlayCancelActionClass).click(S.cancelAction)}}if(S.idPrefix=="qoIncites"&&am=="no"){D(ac).find("."+S.overlayCancelActionClass).click(S.doCancelAction)}if((S.noOptionsForSelections&&(V>0||QuickOutput.isFullRecord()))||S.noOptions){return S.doAction(aa)}D(T).select2("close");D(ac).dialog({dialogClass:"ui-dialog-quickoutput "+S.idPrefix,height:"auto",title:S.titleTemplate()(),modal:true,resizable:false,draggable:false,width:600,closeText:document.getElementById("lang_close").value});if(S.idPrefix=="qoOther"&&D("#saveToOtherFormatDefault").val()!=""){D("#save_options_wrapper #saveOptions").val(D("#saveToOtherFormatDefault").val()).change()}D(".j-custom-select").select2({dropdownAutoWidth:false,minimumResultsForSearch:8});if(S.format=="saveToIncites"||(S.idPrefix=="qoIncites"&&am=="yes")){D(".qoIncites .ui-dialog-titlebar").hide()}if(S.idPrefix=="qoIncites"&&am=="yes"){var U=document.getElementById("DataSetsRemaining").value;if(U=="1"){document.getElementById("oneDatasetInfo").style.display=""}else{if(ah=="0"){document.getElementById("multiDatasetInfo").style.display=""}}if(ah=="0"){var ab=new Date();var ae=ab.getFullYear();var au=ab.getMonth()+1;if(au<10){au="0"+au}var ar=ab.getDate();if(ar<10){ar="0"+ar}var Z=ab.getHours();if(Z<10){Z="0"+Z}var aj=ab.getMinutes();if(aj<10){aj="0"+aj}var at=ab.getSeconds();if(at<10){at="0"+at}document.getElementById("dataSet").value="Web of Science "+ar+au+ae+":"+Z+aj+at}}else{if(S.idPrefix=="qoIncites"){if(document.getElementById("saveToInCitesInstruction")){document.getElementById("saveToInCitesInstruction").style.display="none"}}}D(ac).find("."+S.overlayActionClass).click(S.doAction);D(ac).find("."+S.overlayCancelActionClass).click(S.doCancelAction);S.prepValidator(ac);if(QuickOutput.selectPageTriggersRangeSelection){var ag=QuickOutput.pageSelected?true:false;D(ac).find("#numberOfRecordsAllOnPage").prop("checked",QuickOutput.pageSelected);D(ac).find("#numberOfRecordsRange").prop("disabled",ag);D.each(["markFrom","markTo"],function(ax,aw){D(ac).find('input[name="'+aw+'"]').prop("disabled",ag)})}D.each(["markFrom","markTo"],function(ax,aw){D(ac).find('input[name="'+aw+'"]').change(function(ay){D(ac).find('input[name="value(record_select_type)"][value="range"]').attr("checked","checked")})})},showProcessing:function(U){U.preventDefault();var S=this;if(typeof S.newDiv==="undefined"){return}var W=S.newDiv;if(!S.shouldShowProcessing){return}if(S.idPrefix=="qoOther"){D("#saveToOtherFormatDefault").val(D("#save_options_wrapper #saveOptions").val())}if(typeof S.saveAction!=="undefined"&&S.saveAction!=""&&S.saveAction!=null&&S.saveAction!=".crQuickOutputXLS"&&S.saveAction!=".cr_quickOutputOther"){exportFunctionality(S)}var T=S.numberOfProcessedRecords();if(!(QuickOutput.isMarkedList())&&S.idPrefix!=="qoFastSave"&&S.idPrefix!=="mlAdd"){if(D("#numberOfRecordsSelected").is(":checked")){T=S.markedListCandidates.filter(":checked").length}else{if(D("#numberOfRecordsAllOnPage").is(":checked")){T=S.markedListCandidates.length}else{if(S.isRangeSelected(W)){T=S.numberOfRecordsForRange(W)}}}}var V=(S.idPrefix==="qoRIDSignIn"&&(S.outputViewType==="summary"||S.outputViewType==="distincAuthorSet"))||(S.idPrefix==="qoproxyClaim"&&(S.outputProxyViewfType==="summary"||S.outputProxyViewType==="distincAuthorSet"))||QuickOutput.isMarkedList()?T:QuickOutput.isFullRecord()&&S.idPrefix!="qoRIDSignIn"?1:S.isRangeSelected(W)&&T<1?S.numberOfRecordsForRange(W):T>=1?((T>QUICK_OUTPUT_MAX_RECORDS)&&S.idPrefix!="qoIncites")?QUICK_OUTPUT_MAX_RECORDS:T:S.markedListCandidates.length;var Y=V>1?S.sendingMessageTemplate():S.sendingOneMessageTemplate();D(W).html(S.sendingTemplate({message:Y({selectedCount:S.formatNumberWithcommas(V)})}));if(S.noOptions||S.noOptionsOnMarkedList){D(".saveToMenu").filter("select").select2("close");D(W).dialog({dialogClass:"ui-dialog-quickoutput",height:"auto",title:S.sendingTitleTemplate()(),modal:true,resizable:false,width:600,draggable:false,closeText:document.getElementById("lang_close").value});D(W).dialog("widget").animate({height:"auto"})}else{D(W).dialog("option",{title:S.sendingTitleTemplate()()})}if(typeof S.spinner!=="undefined"){S.spinner.spin(false)}var X=D(W).find(".spinner");X.spin({lines:12,length:4,width:2,radius:4,top:0,left:-25});D(W).find("."+S.overlayCancelActionClass).click(S.doCancelAction)},submitForm:function(W){var S=this;if(!S.autosubmitForm){return}var U=/(<form\s+[\s\S]+<\/\s*form>)/im;var V=W.match(U);if(!V||V.length<2){return}var T=D(document.createElement("div")).html(V[1]).css("display","none");D("body").append(T);T.find('form[name="'+S.autosubmitForm+'"]').submit();T.remove()},classText:function(V,W){var aa=new RegExp('<div(?=\\s+[^=]+=[\'"][^\'"]+[\'"])*\\s+class="'+W+'"([\\s\\S]+)',"im");var X=V.match(aa);if(!X||X.length<2){return""}var Y=/>([\s\S]+)/im;var T=X[1].match(Y);if(!T||T.length<2){return""}var Z=T[1];var S=Z.indexOf(">");if(S===-1||S===Z.length){return""}var U=Z.indexOf("</");if(U===-1){return""}return Z.substring(0,U)},showFormattedError:function(U){var S=this;var T=S.newDiv;if(typeof S.newDiv!=="undefined"){if(S.showErrorButton){if(S.idPrefix=="qoIncites"){D(T).dialog("widget").animate({height:"280px"});D(T).html(S.errorTemplate()({message:U,buttons:(S.closeActionTemplate()())}));if(S.shouldRefreshAfter){D(T).find("."+S.overlayCancelActionClass).click(S.doRefreshAction)}else{D(T).find("."+S.overlayCancelActionClass).click(S.doCancelAction)}}else{D(T).dialog("widget").animate({height:"200px"});D(T).html(S.errorTemplate()({message:U,buttons:(S.closeActionTemplate()())}));D(T).find('input[name="errorCancel"]').click(this.doCancelAction)}}else{D(T).html(S.errorTemplate()({message:U,buttons:""}));setTimeout(function(){D(T).dialog("close")},5000)}}},showJsonError:function(W,U){var T=(function(){var Y=/(\{[\s\S]+\})/im;var Z=W.match(Y);if(!Z||Z.length<2){return"{}"}return Z[1]})();var V={};try{V=JSON.parse(T)}catch(X){return false}if(typeof V==="undefined"||typeof V.error==="undefined"||V.error.length<1){return false}var S=this;S.showFormattedError(V.error);return true},showError:function(X,V){var U=this;var T=(function(){var aa=/<div(?=\s+[^=]+=['"][^'"]+['"])*\s+class="errorMessage"([\s\S]+)/im;var Z=X.match(aa);if(!Z||Z.length<2){return""}return Z[1].substr(0,512)})();var W=U.classText(T,"errorHead");var S=U.classText(T,"errorText");if(!S.length){return U.showJsonError(X,V)}var Y=W.length?W+": "+S:S;if(typeof U.newDiv==="undefined"){U.uncheckSelections();return true}U.showFormattedError(Y);return true},postToNewWindow:function(U,T){var W=window.open("","_blank");if(typeof W==="undefined"||typeof W.document==="undefined"){return}var V=W.document.open();V.write(U);V.close();var S=this;if(typeof S.newDiv!=="undefined"){D(S.newDiv).dialog("close")}S.uncheckSelections()},showConfirmation:function(X,U){if(typeof U!=="undefined"&&typeof U.preventDefault!=="undefined"){U.preventDefault()}var T=this;if(T.shouldPostToNewWindow){return T.postToNewWindow(X,U)}if(typeof T.newDiv==="undefined"){T.uncheckSelections();return}var V=T.newDiv;if(T.idPrefix=="qoRIDSignIn"&&X.indexOf("Export Transfer Service")==-1&&X.indexOf("ridRegistrationForm")==-1){T.shouldBackAfter=false;try{var S=X.replace(/^[\S\s]*<body[^>]*?>/i,"").replace(/<\/body[\S\s]*$/i,"");jQuery("body").html(S)}catch(Z){jQuery("body").html(X)}if(!D(V).hasClass("ui-dialog-content")){D(V).dialog({autoOpen:false,dialogClass:"ui-dialog-quickoutput",height:"auto",modal:true,resizable:false,width:600,draggable:false,closeText:document.getElementById("lang_close").value})}}if(T.idPrefix=="qoRIDSignIn"&&X.indexOf("ridRegistrationForm")!=-1){D(V).dialog("close");document.getElementById("emailPasswordError").style.display="";return}if(T.idPrefix=="qoPublons"){var Y=JSON.parse(X);var W=Y.PublonsUrl;if(W!=null){window.open(W,"Publons")}}T.submitForm(X);setTimeout(function(){D(V).find(".spinner").spin(false);if(T.showError(X,U)){return}var ab=4000;D(V).dialog("option",{title:T.sentTitleTemplate()()});if(T.sentMessageTemplate){var ad=(T.idPrefix=="qoRIDSignIn")?T.numberOfProcessedRecords():T.numberOfProcessedRecords(X);if(!T.hasConfirmation){D(V).dialog("widget").animate({height:"auto"})}if(T.idPrefix=="qoIncites"){D(V).find("."+T.overlayCancelActionClass).click(T.doDoneAction);D(V).dialog("widget").animate({height:"auto"});ab=90000}T.outputViewType=D("#loginForm").find('input[name="viewType"]').val();T.outputProxyViewType=D("#ProxyClaimForm").find('input[name="viewType"]').val();if(!(QuickOutput.isMarkedList())&&T.idPrefix!=="qoFastSave"&&T.idPrefix!=="mlAdd"){if(D("#numberOfRecordsSelected").is(":checked")){ad=T.markedListCandidates.filter(":checked").length}else{if(D("#numberOfRecordsAllOnPage").is(":checked")){ad=T.markedListCandidates.length}else{if(T.isRangeSelected(V)){ad=T.numberOfRecordsForRange(V)}}}}var ag=(T.idPrefix==="qoRIDSignIn"&&(T.outputViewType=="summary"||T.outputViewType=="distincAuthorSet"))||(T.idPrefix==="qoproxyClaim"&&(T.outputProxyViewType=="summary"||T.outputProxyViewType=="distincAuthorSet"))||QuickOutput.isMarkedList()?ad:QuickOutput.isFullRecord()?1:T.isRangeSelected(V)&&ad<1?T.numberOfRecordsForRange(V):ad>=1?((ad>QUICK_OUTPUT_MAX_RECORDS)&&T.idPrefix!="qoIncites")?QUICK_OUTPUT_MAX_RECORDS:ad:T.markedListCandidates.length;var ae=(ag<=1&&T.idPrefix!="qoIncites")?T.sentOneMessageTemplate():T.sentMessageTemplate();D(V).html(T.sentTemplate()({message:ae({processed:ag,email:(T.savedEmailAddress?T.savedEmailAddress:"")}),buttons:(T.hasConfirmation||T.idPrefix=="qoIncites"?"":T.actionSentButtonsTemplate()({action:T.instructionActionTemplate()(),cancelaction:T.sentCloseActionTemplate()()}))}));if(!T.hasConfirmation){var aa;if(T.idPrefix=="qoCRXLS"){aa="cited-rep-export-excel-send-to-file-send"}else{if(T.idPrefix=="qoCROther"){aa="cited-rep-export-text-send-to-file-send"}}if(aa!=""&&aa!=null&&aa!=undefined){trackSnowplowEventSE(aa)}D(V).find("."+T.overlayActionClass+" input").click(function(ah){ah.preventDefault();D("#saveDiv").find("form").submit()});D(V).find("."+T.overlayCancelActionClass).click(T.doCancelAction)}}else{D(V).dialog("option",{hide:{effect:"fade",duration:ab}});D(V).dialog("close")}T.uncheckSelections();var af=1500;if(T.idPrefix=="qoIncites"){if(T.shouldRefreshAfter){D(V).find("."+T.overlayCancelActionClass).click(T.doRefreshAction)}else{D(V).find("."+T.overlayCancelActionClass).click(T.doDoneAction)}D(V).dialog("widget").animate({height:"auto"});af=6000;if(T.shouldRefreshAfter){af=70000}}if(T.shouldRefreshAfter){setTimeout(function(){if(T.hasConfirmation){D(V).dialog("option",{hide:{effect:"fade",duration:500}});D(V).dialog("close");setTimeout(function(){var ak=D("#goToPage");if(ak.length>0){D("#goToPage").click()}else{var aj=location.href;if(aj.indexOf("ExcludeIfFromNonInterProduct")>-1){aj=aj.replace("ExcludeIfFromNonInterProduct","ExcludeIfReload")}if(aj.indexOf("ExcludeIfFromFullRecPage")>-1){aj=aj.replace("EExcludeIfFromFullRecPage","ExcludeIfReload")}if(aj.indexOf("excludeEventConfig")==-1){aj=aj+"&excludeEventConfig=ExcludeIfReload"}if(aj.indexOf("exclude=")>1&&aj.indexOf("InboundService.do")>1){window.location.reload()}else{window.location.replace(aj)}}},af)}else{var ai=D("#goToPage");if(ai.length>0){D("#goToPage").click()}else{var ah=location.href;if(ah.indexOf("ExcludeIfFromNonInterProduct")>-1){ah=ah.replace("ExcludeIfFromNonInterProduct","ExcludeIfReload")}if(ah.indexOf("ExcludeIfFromFullRecPage")>-1){ah=ah.replace("EExcludeIfFromFullRecPage","ExcludeIfReload")}if(ah.indexOf("excludeEventConfig")==-1){ah=ah+"&excludeEventConfig=ExcludeIfReload"}if(ah.indexOf("exclude=")>1&&ah.indexOf("InboundService.do")>1){window.location.reload()}else{window.location.replace(ah)}}}},af)}else{var ac=function(){var ah=decodeURIComponent(T.returnUrl);window.location.replace(ah)};if((T.hasConfirmation||T.shouldFadeAfter)&&T.idPrefix!="qoIncites"){setTimeout(function(){D(V).dialog("option",{hide:{effect:"fade",duration:ab}});D(V).dialog("close");if(T.shouldBackAfter){setTimeout(ac,ab)}},1500)}else{if(T.shouldBackAfter){setTimeout(ac,3000)}}}},3000)}});var l=n.extend({csiId:"HS_EndNoteLink",el:D(".quickOutputENW"),extraParams:"&save_options=othersoftware",format:"saveToENW",hasConfirmation:true,idPrefix:"qoENW",newWindow:false,noOptionsOnMarkedList:true,shouldRemoveRurl:false,saveAction:".quickOutputENW",shouldRefreshAfter:true,shouldSignIn:"true",shouldShowProcessing:true,showErrorButton:true,render:function(){D(".quickOutputENW").click(function(){updateResultOptions("saveAgain","quickOutputENW")});D(".quickOutputENW").click(this.showOptions);return this}});var C=l.extend({el:D(".quickOutputRID"),format:"saveToRID",idPrefix:"qoRID",saveAction:".quickOutputRID",shouldRefreshAfter:true,shouldCertifyPublicationsForRID:true,paramHelper:function(S){var T=D(S).find('input[name="colName"]');if(T==="DIIDW"){D(S).find('input[name="mode"]').val("quickOutputForDII")}return""},render:function(){D(".quickOutputRID").click(function(){updateResultOptions("saveAgain","quickOutputRID")});D(".quickOutputRID").click(this.showOptions);return this}});var B=l.extend({el:D(".quickOutputPublons"),format:"saveToPublons",idPrefix:"qoPublons",saveAction:".quickOutputPublons",shouldRefreshAfter:false,shouldSignIn:false,noDetails:true,shouldCertifyPublicationsForRID:true,paramHelper:function(S){var T=D(S).find('input[name="colName"]');if(T==="DIIDW"){D(S).find('input[name="mode"]').val("quickOutputForDII")}return""},render:function(){D(".quickOutputPublons").click(function(){updateResultOptions("saveAgain","quickOutputPublons")});D(".quickOutputPublons").click(this.showOptions);return this}});var L=l.extend({el:D(".quickOutputRefWorks"),format:"saveToRefWorks",idPrefix:"qoRefWorks",saveAction:".quickOutputRefWorks",shouldRefreshAfter:false,shouldSignIn:false,autosubmitForm:"ExportRWForm",render:function(){D(".quickOutputRefWorks").click(function(){updateResultOptions("saveAgain","quickOutputRefWorks")});D(".quickOutputRefWorks").click(this.showOptions);return this}});var K=l.extend({el:D(".quickOutputIncites"),format:"saveToIncites",hasConfirmation:true,idPrefix:"qoIncites",newWindow:false,noOptionsOnMarkedList:false,shouldRemoveRurl:true,saveAction:".quickOutputIncites",shouldRefreshAfter:false,shouldSignIn:"true",shouldShowProcessing:true,showErrorButton:true,fileDownload:false,render:function(){D(".quickOutputIncites").click(function(){updateResultOptions("saveAgain","quickOutputIncites")});D(".quickOutputIncites").click(this.showOptions);return this}});var v=Backbone.View.extend({el:D(".export_options"),quickOutputTemplate:_.template(D("#qoExportOptionsTemplate").html()),initialize:function(){_.bindAll(this,"render");this.render();return this},render:function(){this.$el.html(this.quickOutputTemplate())}});var s=new v({model:new R()});var G=Backbone.View.extend({el:D(".saveToButton"),quickOutputTemplate:_.template(D("#quickOutputTemplate").html()),initialize:function(){_.bindAll(this,"render");this.render();return this},render:function(){this.$el.html(this.quickOutputTemplate());var S=new E({model:new R()});var W=new Q({model:new R()});var V=new l({model:new R()});var Z=new C({model:new R()});var Y=new B({model:new R()});var aa=new L({model:new R()});var ab=new o({model:new R()});var T=new P({model:new R()});var X=new K({model:new R()});this.$el.show();this.$el.css({visibility:"visible"});if(D(".saveToMenu").length){var U=D(".saveToMenu").filter("select");U.change(function(ad){ad.preventDefault();var ac=ad.currentTarget.value;switch(ac){case"fecyt":trackSnowplowEventSE("save-to-FECYT-CVN-click");S.showOptions(ad);break;case"enw":trackSnowplowEventSE("save-to-EndNote-online-click");V.showOptions(ad);break;case"rid":trackSnowplowEventSE("save-to-RID-click");Z.showOptions(ad);break;case"publons":Y.showOptions(ad);break;case"refworks":trackSnowplowEventSE("save-to-refworks-click");aa.showOptions(ad);break;case"endnote":trackSnowplowEventSE("save-to-EndNote-desktop-click");ab.showOptions(ad);break;case"incites":trackSnowplowEventSE("save-to-incites-click");X.showOptions(ad);break;case"pansforderpict":T.showOptions(ad);break;case"other":default:trackSnowplowEventSE("save-to-other-file-formats-click");W.showOptions(ad)}D(U).val(ac).trigger("change.select2")});U.select2().val("")}return this}});var z=G.extend({el:D(".cr_saveToButton_top"),quickOutputTemplate:_.template(D("#cr_quickOutputTemplateTop").html()),render:function(){this.$el.html(this.quickOutputTemplate());var V=new m();var U=new F();V.$el.parent().buttonset().next().hide().menu();var W=new j({model:new R()});var T=new p({model:new R()});this.$el.show();this.$el.css({visibility:"visible"});if(D(".saveToMenu").length){var S=D("#cr_saveToMenuTop").filter("select").select2({dropdownAutoWidth:true,minimumResultsForSearch:Infinity});S.change(function(Y){Y.preventDefault();var X=Y.currentTarget.value;switch(X){case"xls":if(typeof crCharts!=="undefined"&&crCharts!==null){QuickOutput.selectExportType="xls";crCharts.publishedItems.renderExportChart();crCharts.timesCited.renderExportChart()}trackSnowplowEventSE("cited-rep-export-excel-click");T.showOptions(Y);break;case"other":default:trackSnowplowEventSE("cited-rep-export-text-click");W.showOptions(Y)}D(S).val(X).trigger("change.select2")});S.val("")}return this}});var d=G.extend({el:D(".cr_saveToButton"),quickOutputTemplate:_.template(D("#cr_quickOutputTemplateBottom").html()),render:function(){this.$el.html(this.quickOutputTemplate());var V=new m();var U=new F();V.$el.parent().buttonset().next().hide().menu();var W=new j({model:new R()});var T=new p({model:new R()});this.$el.show();this.$el.css({visibility:"visible"});if(D(".saveToMenuBottom").length){var S=D("#cr_saveToMenuBottom").filter("select").select2({dropdownAutoWidth:true,minimumResultsForSearch:Infinity});S.change(function(Y){Y.preventDefault();var X=Y.currentTarget.value;switch(X){case"xls":if(typeof crCharts!=="undefined"&&crCharts!==null){QuickOutput.selectExportType="xls";crCharts.publishedItems.renderExportChart();crCharts.timesCited.renderExportChart()}trackSnowplowEventSE("cited-rep-export-excel-click");T.showOptions(Y);break;case"other":default:trackSnowplowEventSE("cited-rep-export-text-click");W.showOptions(Y)}D(S).val(X).trigger("change.select2")});S.val("")}return this}});var e=n.extend({el:D(".formatForPrintButton"),format:"formatForPrint",idPrefix:"qoPrint",newWindow:true,saveAction:".quickOutputPrint",noOptionsOnMarkedList:true,shouldRemoveRurl:true,render:function(){D(".quickOutputPrint").click(this.showOptions);return this}});var u=n.extend({el:D(".fastSaveButton"),format:"fastSave",idPrefix:"qoFastSave",newWindow:true,noOptionsOnMarkedList:false,shouldExecuteRecaptcha:true,saveAction:".quickOutputFastSave",shouldShowProcessing:true,showErrorButton:true,fileDownload:true,numberOfRecordsTemplate:_.template(D("#qoFastSaveNumberOfRecordsTemplate").html()),shouldRemoveRurl:true,render:function(){D(".quickOutputFastSave").click(this.showOptions);return this}});var A=n.extend({el:D(".saveToEmailButton"),format:"email",hasConfirmation:true,idPrefix:"qoEmail",saveAction:".quickOutputEmail",newWindow:false,shouldFadeAfter:true,shouldRemoveRurl:false,shouldShowProcessing:true,render:function(){D(".quickOutputEmail").click(this.showOptions);return this}});var r=n.extend({el:D(".addToMarkedListButton"),format:false,idPrefix:"mlAdd",noOptionsOnMarkedList:true,refreshWindow:true,shouldRemoveRurl:true,shouldShowProcessing:true});var w=n.extend({el:D(".ridSignInButton"),format:"saveToRID",formName:"loginForm",hasConfirmation:true,idPrefix:"qoRIDSignIn",noOptions:true,shouldRefreshAfter:false,refreshWindow:false,shouldBackAfter:true,shouldRemoveRurl:false,shouldShowProcessing:true,returnUrl:"",render:function(){D(".ridSignInButton").click(this.showOptions);return this},numberOfProcessedRecords:function(T){if(typeof T==="undefined"){var S=this;var V=D("#loginForm");var X=D(V).find('input[name="viewType"]').val();if(typeof X==="undefined"){V=D("#ProxyClaimForm");X=D(V).find('input[name="viewType"]').val()}if(X=="fullRecord"){return 1}if(X=="distincAuthorSet"){var Z=D(V).find('input[name="mark_from"]').val();var aa=D(V).find('input[name="mark_to"]').val();var W=aa-Z+1;return W>QUICK_OUTPUT_MAX_RECORDS?QUICK_OUTPUT_MAX_RECORDS:W}if(X=="summary"){var Y=S.model.get("totalMarked");if(!Y){var Z=D(V).find('input[name="mark_from"]').val();var aa=D(V).find('input[name="mark_to"]').val();if(aa&&Z){Y=aa-Z+1}}return Y>QUICK_OUTPUT_MAX_RECORDS?QUICK_OUTPUT_MAX_RECORDS:Y}}var ab=/<input(?:\s+\S+)+\s+name="numRecords"\s+value="(\d+)"[^>]*?>/;var U=T.match(ab,"gim");if(!U||U.length<2){return 0}return parseInt(U[1])}});var g=n.extend({el:D(".distinctAuthorSetButton"),format:"saveToRID",formName:"claim_pub_form",hasConfirmation:true,idPrefix:"qodistinctAuthorSet",noOptionsOnMarkedList:true,noOptionsForSelections:true,shouldCertifyPublicationsForRID:true,shouldRefreshAfter:false,refreshWindow:false,shouldRemoveRurl:false,shouldSignIn:true,shouldShowProcessing:true,returnUrl:"",paramHelper:function(S){return"viewType=distincAuthorSet"},render:function(){var S=this;D(window).load(function(){D(".distinctAuthorSetButton").unbind("click");D(".distinctAuthorSetButton").click(S.showOptions)});return S}});var f=n.extend({el:D(".proxyClaimButton"),format:"saveToRID",formName:"ProxyClaimForm",hasConfirmation:true,idPrefix:"qoproxyClaim",noOptionsOnMarkedList:true,noOptionsForSelections:true,shouldRefreshAfter:false,refreshWindow:false,shouldBackAfter:true,shouldRemoveRurl:false,shouldShowProcessing:true,returnUrl:"",render:function(){D.when(D(".proxyClaimButton").click(this.showOptions)).done(function(){D(".proxyClaimButton").show()});return this}});var Q=n.extend({el:D(".quickOutputOther"),fileDownload:true,format:"saveToFile",idPrefix:"qoOther",saveAction:".quickOutputOther",shouldRemoveRurl:false,shouldShowProcessing:true,render:function(){D(".quickOutputOther").click(function(){updateResultOptions("saveAgain","quickOutputOther")});D(".quickOutputOther").click(this.showOptions);return this}});var E=Q.extend({el:D(".quickOutputFECYT"),extraParams:"&save_options=fecyt",format:"saveToFile",idPrefix:"qoFECYT",saveAction:".quickOutputFECYT",shouldRefreshAfter:false,shouldSignIn:false,noOptionsForSelections:true,shouldShowProcessing:true,noOptionsOnMarkedList:true,autosubmitForm:"ExportRWForm",hasConfirmation:false,render:function(){D(".quickOutputFECYT").click(function(){updateResultOptions("saveAgain","quickOutputFECYT")});D(".quickOutputFECYT").click(this.showOptions);return this}});var j=Q.extend({el:D(".cr_quickOutputOther"),extraParams:"save_options=csv",fileDownload:true,formName:"summary_records_form",format:"crsaveToFile",idPrefix:"qoCROther",noOptionsForSelections:true,noOptionsOnMarkedList:true,shouldShowProcessing:true,noSaveAction:true,numberOfRecordsTemplate:_.template(D("#qoCRNumberOfRecordsTemplate").html()),saveAction:".cr_quickOutputOther",render:function(){D(".cr_quickOutputOther").click(function(){updateResultOptions("CitationReport:saveAgain","cr_quickOutputOther")});D(".cr_quickOutputOther").click(this.showOptions);return this}});var p=j.extend({el:D(".crQuickOutputXLS"),extraParams:"save_options=xls",idPrefix:"qoCRXLS",formName:"summary_records_form",noOptionsForSelections:true,shouldShowProcessing:true,noOptionsOnMarkedList:true,noSaveAction:true,numberOfRecordsTemplate:_.template(D("#qoCRNumberOfRecordsTemplate").html()),saveAction:".crQuickOutputXLS",render:function(){D(".crQuickOutputXLS").click(function(){updateResultOptions("CitationReport:saveAgain","crQuickOutputXLS")});D(".crQuickOutputXLS").click(this.showOptions);return this}});var o=Q.extend({el:D(".quickOutputEndNote"),extraParams:"&save_options=othersoftware",format:"saveToRef",idPrefix:"qoEndNote",noOptionsOnMarkedList:true,saveAction:".quickOutputEndNote",render:function(){D(".quickOutputEndNote").click(function(){updateResultOptions("saveAgain","quickOutputEndNote")});D(".quickOutputEndNote").click(this.showOptions);return this}});var P=Q.extend({el:D(".pansForDerpict"),extraParams:"&save_options=pans4derpict",format:"saveToFile",idPrefix:"qoOther",noOptionsOnMarkedList:true,saveAction:".pansForDerpict",render:function(){D(".pansForDerpict").click(function(){updateResultOptions("saveAgain","pansForDerpict")});D(".pansForDerpict").click(this.showOptions);return this}});var y=n.extend({el:D(".crFormatForPrintButton"),format:"crformatForPrint",formName:"summary_records_form",idPrefix:"qoCRPrint",noOptionsForSelections:true,noOptionsOnMarkedList:true,noSaveAction:true,shouldRemoveRurl:true,numberOfRecordsTemplate:_.template(D("#qoCRNumberOfRecordsTemplate").html()),mode:"outputService",shouldPostToNewWindow:true,shouldShowProcessing:true});var c=n.extend({el:D(".crSaveToEmailButton"),extraParams:"&save_options=tabWinUnicode",format:"cremail",formName:"summary_records_form",idPrefix:"qoCREmail",hasConfirmation:true,noOptionsOnMarkedList:true,noSaveAction:true,newWindow:false,shouldRemoveRurl:true,shouldFadeAfter:true,shouldShowProcessing:true,numberOfRecordsTemplate:_.template(D("#qoCRNumberOfRecordsTemplate").html()),useBothForm:true,mode:"outputService"});var q=new G({model:new R()});var N=new d({model:new R()});var b=new z({model:new R()});var a=new A({model:new R()});var x=new e({model:new R()});var H=new u({model:new R()});var J=new c({model:new R()});var k=new y({model:new R()});var M=new r({model:new R()});var O=new w({model:new R()});var t=new f({model:new R()});var I=new g({model:new R()});D(function(){if(!QuickOutput.selectionsAvailable()){D(".summary_quickTopButtons").hide()}});if(QuickOutput.isSafari){D.event.props=D.event.props.join("|").replace("layerX|layerY|","").split("|")}D.extend(D.validator.messages,{email:D("#qoEmailValidationError").html()});var h=D("#markedListLabel").html();D(".addToMarkedList").click(M.showOptions);D(".addToMarkedList").click(function(){D(NumberOfRecLabel).html(h);D(".quick-output-section-content #records-range-to #markTo").val(MARKED_LIST_MAX_RECORDS)})})(jQuery);$(".select2-selection__rendered").not("#select2-cr_saveToMenuTop-container, #select2-cr_saveToMenuBottom-container").on("mouseup touchend",function(g){var c=$(".saveToMenu");var f=$(c).get(0);$(f).select2("close");var d=$(g.currentTarget).text();var b=$(f).children();var a;$.each(b,function(h,e){if($(e).text()==d){a=$(e).val();return false}});$(f).val(a).trigger("change")});$("#select2-cr_saveToMenuTop-container").on("mouseup touchend",function(g){var c=$(".saveToMenu");var f=$(c).get(0);$(f).select2("close");var d=$(g.currentTarget).text();var b=$(f).children();var a;$.each(b,function(h,e){if($(e).text()==d){a=$(e).val();return false}});$(f).val(a).trigger("change")});$("#select2-cr_saveToMenuBottom-container").on("mouseup touchend",function(g){var c=$(".saveToMenuBottom");var f=$(c).get(0);$(f).select2("close");var d=$(g.currentTarget).text();var b=$(f).children();var a;$.each(b,function(h,e){if($(e).text()==d){a=$(e).val();return false}});$(f).val(a).trigger("change")});function initSelect2(){$(".j-custom-select").select2({dropdownAutoWidth:false,minimumResultsForSearch:8})}$('input[name="fastSave"]').click(function(){captcha.userSIDVerify=$("#captcha_token").val();if(!captcha.userSIDVerify&&captcha.recaptchaVerified==true){captcha.userSIDVerify=captcha.token}if($("#google_recaptcha_wall").val().toLowerCase()!=="off"&&!captcha.userSIDVerify&&$("#HS_EndNoteLink_signedin").length!==0){$(".quickoutput-overlay-buttonset").css("visibility","hidden");var a=$("#recaptchaRenderUrl").first().text();$.when($.ajax({type:"GET",url:a,success:function(b){$("#qoFastSaveRecaptcha").html(b)},error:function(){(".quickoutput-overlay-buttonset").css("visibility","visible");captcha.recaptchaVerified==true}})).then(function(){setTimeout(function(){$(".quickoutput-overlay-buttonset").css("visibility","visible")},1500);setTimeout(function(){grecaptcha.execute()},1500)})}});function enableExportButton(){$("#exportButton.inactive-button").addClass("onload-primary-button").removeClass("inactive-button");$("#printButton.inactive-button").addClass("onload-primary-button").removeClass("inactive-button");$("#emailButton.inactive-button").addClass("onload-primary-button").removeClass("inactive-button");$("#markedListButton.inactive-button").addClass("onload-primary-button").removeClass("inactive-button");$("#crprintButton.inactive-button").addClass("onload-primary-button").removeClass("inactive-button");$("#cremailButton.inactive-button").addClass("onload-primary-button").removeClass("inactive-button");$(".quickoutput-action").removeAttr("style")}function floatingCsskeyUp(a){if($(a).val().length>0){$(a).addClass("non-empty")}else{$(a).removeClass("non-empty")}};